(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/live/live"],{"18f9":function(t,e,n){"use strict";var o=n("e500"),i=n.n(o);i.a},"359e":function(t,e,n){"use strict";(function(t){n("0df7");o(n("66fd"));var e=o(n("86fd"));function o(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=n,t(e.default)}).call(this,n("543d")["createPage"])},"6c01":function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return o}));var o={uImage:function(){return n.e("node-modules/uview-ui/components/u-image/u-image").then(n.bind(null,"a539"))},uInput:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-input/u-input")]).then(n.bind(null,"9f5c"))},uIcon:function(){return n.e("node-modules/uview-ui/components/u-icon/u-icon").then(n.bind(null,"155e"))},uPopup:function(){return n.e("node-modules/uview-ui/components/u-popup/u-popup").then(n.bind(null,"210d"))},list:function(){return n.e("components/list/list").then(n.bind(null,"86b5"))},CardProductCell:function(){return Promise.all([n.e("common/vendor"),n.e("components/CardProductCell/CardProductCell")]).then(n.bind(null,"997e"))}},i=function(){var t=this,e=t.$createElement;t._self._c},r=[]},"7cb3":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=s(n("a34a")),i=n("26cb"),r=s(n("0e7a"));function s(t){return t&&t.__esModule?t:{default:t}}function a(t,e,n,o,i,r,s){try{var a=t[r](s),c=a.value}catch(u){return void n(u)}a.done?e(c):Promise.resolve(c).then(o,i)}function c(t){return function(){var e=this,n=arguments;return new Promise((function(o,i){var r=t.apply(e,n);function s(t){a(r,o,i,s,c,"next",t)}function c(t){a(r,o,i,s,c,"throw",t)}s(void 0)}))}}function u(t){return f(t)||h(t)||d(t)||l()}function l(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function d(t,e){if(t){if("string"===typeof t)return m(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(t,e):void 0}}function h(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function f(t){if(Array.isArray(t))return m(t)}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function p(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?p(Object(n),!0).forEach((function(e){g(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function g(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var _=function(){n.e("components/like-button").then(function(){return resolve(n("e924"))}.bind(null,n)).catch(n.oe)},y=function(){n.e("components/list/list").then(function(){return resolve(n("86b5"))}.bind(null,n)).catch(n.oe)},b=function(){Promise.all([n.e("common/vendor"),n.e("components/CardProductCell/CardProductCell")]).then(function(){return resolve(n("997e"))}.bind(null,n)).catch(n.oe)},w=(n("dc65"),{mixins:[r.default],data:function(){return{plist:[],loadStatus:"nomore",inputStyle:{padding:"0 20rpx",color:"#fff"},title:"video",src:"",showVideo:!1,vHeight:0,rowVideo:!1,options:{autoplay:!0,flv:"",m3u8:"",poster:""},userInfo:{nick:"",avatar:"",userId:"",userSig:"",like_num:""},chatroomId:0,login:"",zt:1,scrollTop:0,scrollHeight:0,msgList:[],textMsg:"",active_index:0,product_list:{p:1,list:[],hasmore:!0,init:!1},TIM:null,keyHeight:0,isFocus:!1,isInput:!1,room_name:"",room_num:0,room_avatar:"",chatScroll:0,chatpdtp:320,chatTouchFlag:!1,productListShow:!1,room_dianzan:0,livePoster:"",tjProduct:{},live_src:"",live_follow:0,shareOptions:{pageName:"直播间"}}},components:{likeButton:_,List:y,CardProductCell:b},created:function(){var t=this;t.TIM=t.$TIM,t.$store.commit("createConversationActive","GROUPsyb_room")},onShareTimeline:function(){return{title:this.shareOptions.pageName,query:"roomid=".concat(this.chatroomId)}},onShareAppMessage:function(t){return{title:this.shareOptions.pageName,path:"/"+this.$scope.route+"?roomid="+this.chatroomId}},onLoad:function(e){e.hasOwnProperty("roomid")?this.chatroomId=e.roomid:this.chatroomId="1",this.enter_room(),t.setKeepScreenOn({keepScreenOn:!0})},destroyed:function(){t.setKeepScreenOn({keepScreenOn:!1})},onReady:function(e){this.videoContext=t.createVideoContext("myVideo")},computed:v(v({},(0,i.mapState)({currentMessageList:function(t){return t.currentMessageList},tim_login:function(t){return t.tim_login}})),{},{StatusBar:function(){return this.$store.state.StatusBar},CustomBar:function(){return this.$store.state.CustomBar}}),watch:{currentMessageList:function(t,e){if(0!=t.length){var n=t[t.length-1];n.payload.extension==this.chatroomId&&("recommend_room_product"==n.payload.data?console.log("推荐产品"):"like"==n.payload.data?(this.room_dianzan++,n.payload.description!=this.userInfo.userId&&this.$refs.likeButton.handleClick()):"system"!=n.payload.data&&"text"!=n.payload.data||("system"==n.payload.data&&(n.payload.description.includes("进入房间")?this.add_room_num():n.payload.description.includes("退出房间")&&this.del_room_num()),this.msgList=[].concat(u(this.msgList),[n])))}},msgList:function(e){var n=this;this.chatTouchFlag||(e.length>10&&(this.chatpdtp=20),this.$nextTick((function(){t.createSelectorQuery().in(n).select("#msgList").boundingClientRect((function(t){n.chatScroll!=t.height&&(n.chatScroll=t.height)})).exec()})))}},mounted:function(){},methods:{followBtn:function(){var e=this;return c(o.default.mark((function n(){return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(1!=e.live_follow){n.next=3;break}return t.showToast({title:"您已关注本直播间"}),n.abrupt("return");case 3:return n.next=5,e.$http.get("/login_follow");case 5:n.sent;case 6:case"end":return n.stop()}}),n)})))()},handlePathDetail:function(e){t.navigateTo({url:"".concat(e.xcx_pages,"&live=").concat(this.live_src)})},handleShowList:function(){this.productListShow=!0},chatListTouchstart:function(t){this.chatTouchFlag=!0},chatListTouchend:function(t){this.chatTouchFlag=!1},handleScrolltolower:function(){},sendText:function(){if(this.textMsg)if(this.tim_login){var e=this.replaceEmoji(this.textMsg),n={text:e};this.sendMsg(n,"text"),this.textMsg="",t.hideKeyboard()}else t.showToast({title:"尚未加入聊天室",icon:"none"})},handleGetmeadata:function(e){console.log(e);var n=t.getSystemInfoSync(),o=e.detail.height/e.detail.width*n.windowWidth;o<n.windowHeight/2&&(this.rowVideo=!0,this.chatpdtp=450),this.vHeight=o},enter_room:function(){var e=this;this.$http.post("recommend_live_room",{roomid:this.chatroomId}).then((function(t){e.tjProduct=t.data.list.list,e.$nextTick((function(){e.msgList.push({ID:"no1",payload:{data:"system",description:"欢迎大家来到直播间！平台严禁未成年人进行直播或打赏，请大家共同遵守、监督。直播间内禁止出现违法违规、低俗色情、吸烟酗酒及涉政等内容，若有违规行为请及时举报。"}})}))})),this.$http.post("enter_live_room",{roomid:this.chatroomId}).then((function(n){if(console.log(n),1==n.data.code){var o=n.data.list;e.options=o.live_h5,e.room_name=o.live.author,e.shareOptions.pageName=o.live.title,e.room_num=o.online,e.room_dianzan=o.live.num,e.room_avatar=o.live.img,o.live_h5.m3u8?e.live_src=o.live_h5.m3u8.includes("https")?o.live_h5.m3u8:"https:"+o.live_h5.m3u8:n.data.vod_list.list&&0!=n.data.vod_list.list.length&&(e.live_src=n.data.vod_list.list[0].video_url),e.plist=n.data.tj_list.list,e.livePoster=o.live_h5.poster,e.live_follow=n.data.follow,e.userInfo={nick:o.list.nick,avatar:o.list.avatarurl,userId:o.list.userid,userSig:o.list.usersig,like_num:o.list.num},e.zt=o.list.zt,1==o.list.zt&&(e.vHeight=t.getSystemInfoSync().windowHeight,t.showToast({title:"主播还在赶来的路上...",icon:"none"},3e3)),e.login=o.list.live_info.login;var i=e,r=i.tim.login({userID:i.userInfo.userId,userSig:i.userInfo.userSig});r.then((function(t){i.$store.commit("toggleIsLogin",!0);var e=i.tim.joinGroup({groupID:"syb_room",type:i.$TIM.TYPES.GRP_AVCHATROOM});e.then((function(t){})).catch((function(t){console.log("joinGroup error:",t)}))})).catch((function(t){console.warn("login error:",t)})),i.tim.on(i.$TIM.EVENT.SDK_READY,i.onReadyStateUpdate),i.tim.on(i.$TIM.EVENT.MESSAGE_RECEIVED,i.onReceiveMessage),i.tim.on(i.$TIM.EVENT.CONVERSATION_LIST_UPDATED,(function(t){e.$store.commit("updateConversationList",t.data)}))}}))},videoErrorCallback:function(e){console.log(e),e.detail.errMsg&&(this.videoContext.stop(),this.vHeight=t.getSystemInfoSync().windowHeight)},replaceEmoji:function(t){var e=this,n=t.replace(/\[([^(\]|\[)]*)\]/g,(function(t,n){for(var o=0;o<e.emojiList.length;o++)for(var i=e.emojiList[o],r=0;r<i.length;r++){var s=i[r];if(s.alt==t){var a="https://quan001.y.netsun.com/",c='<img src="'+a+e.onlineEmoji[s.url]+'">';return c}}}));return n},fliterMyMsg:function(t){"like"==t.payload.data?this.$refs.likeButton.handleClick():this.msgList=[].concat(u(this.msgList),[t])},sendMsg:function(t,e){var n=this;return c(o.default.mark((function e(){var i;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,n.$http.get("msgcheck",{params:{body:t}});case 2:if(i=e.sent,1==i.data.code){e.next=5;break}return e.abrupt("return");case 5:n.tim_sendMsg("text",t.text);case 6:case"end":return e.stop()}}),e)})))()},tim_sendMsg:function(t,e){var n=this.tim.createCustomMessage({to:"syb_room",conversationType:"GROUP",payload:{data:t,description:e,extension:this.chatroomId}});this.tim.sendMessage(n);this.fliterMyMsg(n)},onReadyStateUpdate:function(t){t.name},onReceiveMessage:function(t){var e=t.data;this.$store.commit("pushCurrentMessageList",e)},add_room_num:function(){this.room_num++},del_room_num:function(){this.room_num--},likeClick:function(){var t=this;this.tim_sendMsg("like",this.userInfo.userId),this.$http.post("Xcx/like_live_room",{roomid:this.chatroomId}).then((function(e){t.room_dianzan++}))}}});e.default=w}).call(this,n("543d")["default"])},"86fd":function(t,e,n){"use strict";n.r(e);var o=n("6c01"),i=n("fcee");for(var r in i)"default"!==r&&function(t){n.d(e,t,(function(){return i[t]}))}(r);n("ef54"),n("18f9");var s,a=n("f0c5"),c=Object(a["a"])(i["default"],o["b"],o["c"],!1,null,"50fc977e",null,!1,o["a"],s);e["default"]=c.exports},"8e3e":function(t,e,n){},e500:function(t,e,n){},ef54:function(t,e,n){"use strict";var o=n("8e3e"),i=n.n(o);i.a},fcee:function(t,e,n){"use strict";n.r(e);var o=n("7cb3"),i=n.n(o);for(var r in o)"default"!==r&&function(t){n.d(e,t,(function(){return o[t]}))}(r);e["default"]=i.a}},[["359e","common/runtime","common/vendor"]]]);